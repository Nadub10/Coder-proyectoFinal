(()=>{"use strict";var e={607:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(r(860)),n=r(824),s=r(505),l=(0,i.default)();l.use(i.default.json()),l.use(i.default.urlencoded({extended:!0})),l.use("/api/productos",s.routerProducts),l.use("/api/carrito",n.routerCart),l.get("/",((e,t)=>{t.json({mensaje:"holis",edad:28,hobbie:"cantar",comida:"parri"})})),l.listen(8080,(()=>{console.log("conectado al puerto 8080")})).on("error",(e=>console.log(`error en el servidor ${e}`)))},824:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.routerCart=void 0;const o=r(860),i=r(40),n=(0,o.Router)();t.routerCart=n;const s=new i.CartContainer("src/database/cartContainer.txt");n.post("/",((e,t)=>{let r=e.body;s.create(r).then((e=>e?t.status(200).json(e):t.status(500).json({error:"Ocurrió un error al crear el carrito"})))})),n.delete("/:id",((e,t)=>{let{id:r}=e.params;r&&s.deleteCartById(parseInt(r)).then((e=>e===parseInt(r)?t.status(200).json(e):t.status(500).json({error:`Ocurrió un error al eliminar el item ${r} `})))})),n.get("/:id/productos",((e,t)=>{let{id:r}=e.params;r&&s.getProductsInCart(parseInt(r)).then((e=>e?t.status(200).json(e):t.status(404).json({error:`Carrito #${r} no encontrado`})))})),n.post("/:id/productos",((e,t)=>{let{id:r}=e.params,o=e.body;s.addProductToCart(o,parseInt(r)).then((e=>e?t.status(200).json(e):t.status(500).json({error:`Ocurrió un error al agregar el producto ${o.id} al carrito ${r} `})))})),n.delete("/:id/productos/:id_prod",((e,t)=>{let{id:r,id_prod:o}=e.params;r&&s.deleteProductFromCart(parseInt(o),parseInt(r)).then((e=>e?t.status(200).json(e):t.status(500).json({error:`Ocurrió un error al eliminar el producto ${o} del carrito ${r} `})))}))},505:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.routerProducts=void 0;const o=r(860),i=r(488),n=(0,o.Router)();t.routerProducts=n;const s=new i.ProductsContainer("src/database/productsContainer.txt");n.get("/:id?",((e,t)=>{let{id:r}=e.params;r?s.getById(parseInt(r)).then((e=>null==e?t.status(404).json({error:"Product not found"}):t.json(e))):s.getAll().then((e=>t.json(e)))})),n.post("/",((e,t)=>{let r=e.body;s.create(r).then((e=>t.json(e)))})),n.put("/:id",((e,t)=>{let{id:r}=e.params,o=e.body;r&&s.update(o).then((e=>e?t.status(200).json(e):t.status(500).json({error:`Ocurrió un error al actualizar el producto ${r}`})))})),n.delete("/:id",((e,t)=>{let{id:r}=e.params;return t.json()}))},40:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},s=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{u(o.next(e))}catch(e){n(e)}}function l(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,l)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CartContainer=void 0;const l=n(r(147));t.CartContainer=class{constructor(e){this.nombreArchivo=e}create(e){return s(this,void 0,void 0,(function*(){try{const t=yield l.promises.readFile(this.nombreArchivo,"utf-8");let r=JSON.parse(t);return r.length?e.id=r[r.length-1].id+1:e.id=1,r.push(e),yield l.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se agregó el carrito: ${e.id}`),e.id}catch(t){return"ENOENT"===t.code?(e.id=1,yield l.promises.writeFile(this.nombreArchivo,JSON.stringify([e],null,2),"utf-8"),console.log(`Se agregó el carrito: ${e.id}`),e.id):t}}))}addProductToCart(e,t){return s(this,void 0,void 0,(function*(){let r=yield this.getAllCarts(),o=r.findIndex((e=>e.id===t));return o>-1?(r[o].products.length?e.id=r[o].products[r[o].products.length-1].id+1:e.id=1,r[o].products.push(e),yield l.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se agregó el producto: ${e.id} al carrito ${r[o].id} `),r[o]):null}))}getAllCarts(){return s(this,void 0,void 0,(function*(){try{const e=yield l.promises.readFile(this.nombreArchivo,"utf-8");return JSON.parse(e)}catch(e){console.log(e)}}))}getCartById(e){return s(this,void 0,void 0,(function*(){return(yield this.getAllCarts()).find((t=>t.id===e))||null}))}getProductsInCart(e){return s(this,void 0,void 0,(function*(){let t=(yield this.getAllCarts()).find((t=>t.id===e));return t?t.products:null}))}deleteCartById(e){return s(this,void 0,void 0,(function*(){try{let t=yield this.getAllCarts(),r=t.findIndex((t=>t.id===e));return t.splice(r,1),yield l.promises.writeFile(this.nombreArchivo,JSON.stringify(t,null,2),"utf-8"),console.log(`Se eliminó el carrito: ${e}`),e}catch(e){return e}}))}deleteProductFromCart(e,t){return s(this,void 0,void 0,(function*(){try{let r=yield this.getAllCarts(),o=r.findIndex((e=>e.id===t)),i=r[o].products.findIndex((t=>t.id===e));return r[o].products.splice(i,1),yield l.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se eliminó el producto: ${e} del carrito ${t} `),e}catch(e){return e}}))}updateFile(e){return s(this,void 0,void 0,(function*(){yield l.promises.writeFile(this.nombreArchivo,JSON.stringify(e,null,2),"utf-8")}))}}},488:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},s=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{u(o.next(e))}catch(e){n(e)}}function l(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,l)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ProductsContainer=void 0;const l=n(r(147));t.ProductsContainer=class{constructor(e){this.nombreArchivo=e}create(e){return s(this,void 0,void 0,(function*(){try{const t=yield l.promises.readFile(this.nombreArchivo,"utf-8");let r=JSON.parse(t);return r.length?e.id=r[r.length-1].id+1:e.id=1,r.push(e),yield l.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se agregó el producto: ${e.id}`),e.id}catch(t){if("ENOENT"===t.code)return e.id=1,l.promises.writeFile(this.nombreArchivo,JSON.stringify([e],null,2),"utf-8"),console.log(`Se agregó el producto: ${e.id}`),e.id;console.log(t)}}))}update(e){return s(this,void 0,void 0,(function*(){try{const t=yield l.promises.readFile(this.nombreArchivo,"utf-8");let r=JSON.parse(t),o=r.findIndex((t=>t.id===e.id));if(o>-1)return r[o]=e,yield l.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se actualizo el producto: ${e.id}`),e.id;throw Error}catch(e){console.log(e)}}))}getAll(){return s(this,void 0,void 0,(function*(){try{const e=yield l.promises.readFile(this.nombreArchivo,"utf-8");return JSON.parse(e)}catch(e){console.log(e)}}))}getById(e){return s(this,void 0,void 0,(function*(){return(yield this.getAll()).find((t=>t.id===e))||null}))}deleteById(e){return s(this,void 0,void 0,(function*(){try{let t=yield this.getAll(),r=t.findIndex((t=>t.id===e));t.splice(r,1),yield l.promises.writeFile(this.nombreArchivo,JSON.stringify(t,null,2),"utf-8"),console.log(`Se eliminó el producto: ${e}`)}catch(e){console.log(e)}}))}}},860:e=>{e.exports=require("express")},147:e=>{e.exports=require("fs")}},t={};!function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}(607)})();