(()=>{"use strict";var t={322:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});const o=new(r(811).ProductsContainer)("src/database/productsContainer.txt");e.default={createProduct:function(t,e,r){let i=t.body;o.create(i).then((t=>e.json(t)),(t=>r(t)))},deleteProduct:function(t,e,r){let{id:i}=t.params;i&&o.deleteById(parseInt(i)).then((t=>e.status(200).json(t)),(t=>r(t)))},updateProduct:function(t,e,r){let{id:i}=t.params,n=t.body;i&&o.update(n).then((t=>e.status(200).json(t)),(t=>r(t)))},getProducts:function(t,e,r){let{id:i}=t.params;i?o.getById(parseInt(i)).then((t=>e.json(t)),(t=>(console.log(t),r(t)))):o.getAll().then((t=>e.json(t)),(t=>r(t)))}}},27:function(t,e,r){var o=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,i)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&o(e,t,r);return i(e,t),e},s=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{d(o.next(t))}catch(t){n(t)}}function u(t){try{d(o.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.CartContainer=void 0;const u=n(r(147));e.CartContainer=class{constructor(t){this.nombreArchivo=t}create(t){return s(this,void 0,void 0,(function*(){try{const e=yield u.promises.readFile(this.nombreArchivo,"utf-8");let r=JSON.parse(e);return r.length?t.id=r[r.length-1].id+1:t.id=1,r.push(t),yield u.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se agregó el carrito: ${t.id}`),t.id}catch(e){return"ENOENT"===e.code?(t.id=1,yield u.promises.writeFile(this.nombreArchivo,JSON.stringify([t],null,2),"utf-8"),console.log(`Se agregó el carrito: ${t.id}`),t.id):e}}))}addProductToCart(t,e){return s(this,void 0,void 0,(function*(){let r=yield this.getAllCarts(),o=r.findIndex((t=>t.id===e));return o>-1?(r[o].products.length?t.id=r[o].products[r[o].products.length-1].id+1:t.id=1,r[o].products.push(t),yield u.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se agregó el producto: ${t.id} al carrito ${r[o].id} `),r[o]):null}))}getAllCarts(){return s(this,void 0,void 0,(function*(){try{const t=yield u.promises.readFile(this.nombreArchivo,"utf-8");return JSON.parse(t)}catch(t){console.log(t)}}))}getCartById(t){return s(this,void 0,void 0,(function*(){return(yield this.getAllCarts()).find((e=>e.id===t))||null}))}getProductsInCart(t){return s(this,void 0,void 0,(function*(){let e=(yield this.getAllCarts()).find((e=>e.id===t));return e?e.products:null}))}deleteCartById(t){return s(this,void 0,void 0,(function*(){try{let e=yield this.getAllCarts(),r=e.findIndex((e=>e.id===t));return e.splice(r,1),yield u.promises.writeFile(this.nombreArchivo,JSON.stringify(e,null,2),"utf-8"),console.log(`Se eliminó el carrito: ${t}`),t}catch(t){return t}}))}deleteProductFromCart(t,e){return s(this,void 0,void 0,(function*(){try{let r=yield this.getAllCarts(),o=r.findIndex((t=>t.id===e)),i=r[o].products.findIndex((e=>e.id===t));return r[o].products.splice(i,1),yield u.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se eliminó el producto: ${t} del carrito ${e} `),t}catch(t){return t}}))}updateFile(t){return s(this,void 0,void 0,(function*(){yield u.promises.writeFile(this.nombreArchivo,JSON.stringify(t,null,2),"utf-8")}))}}},811:function(t,e,r){var o=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,i)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&o(e,t,r);return i(e,t),e},s=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{d(o.next(t))}catch(t){n(t)}}function u(t){try{d(o.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((o=o.apply(t,e||[])).next())}))},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ProductsContainer=void 0;const d=n(r(147)),l=u(r(844));e.ProductsContainer=class{constructor(t){this.nombreArchivo=t}create(t){return s(this,void 0,void 0,(function*(){try{const e=yield d.promises.readFile(this.nombreArchivo,"utf-8");let r=JSON.parse(e);return r.length?t.id=r[r.length-1].id+1:t.id=1,r.push(t),yield d.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se agregó el producto: ${t.id}`),t.id}catch(e){if("ENOENT"===e.code)return t.id=1,d.promises.writeFile(this.nombreArchivo,JSON.stringify([t],null,2),"utf-8"),console.log(`Se agregó el producto: ${t.id}`),t.id;throw new l.default(e,500,"Error")}}))}update(t){return s(this,void 0,void 0,(function*(){try{const e=yield d.promises.readFile(this.nombreArchivo,"utf-8");let r=JSON.parse(e),o=r.findIndex((e=>e.id===t.id));if(-1===o)throw new l.default(`Item no encontrado ${t.id}`,404,"Not found");return r[o]=t,yield d.promises.writeFile(this.nombreArchivo,JSON.stringify(r,null,2),"utf-8"),console.log(`Se actualizo el producto: ${t.id}`),t.id}catch(t){if(t instanceof l.default)throw t;throw new l.default(t,500,"Error")}}))}getAll(){return s(this,void 0,void 0,(function*(){try{const t=yield d.promises.readFile(this.nombreArchivo,"utf-8");return JSON.parse(t)}catch(t){throw new l.default(t,500,"Error")}}))}getById(t){return s(this,void 0,void 0,(function*(){let e=(yield this.getAll()).find((e=>e.id===t));if(e)return e;throw new l.default("Item no encontrado",404,"Not found")}))}deleteById(t){return s(this,void 0,void 0,(function*(){try{let e=yield this.getAll(),r=e.findIndex((e=>e.id===t));if(e.splice(r,1),-1===r)throw new l.default("Item no encontrado",404,"Not found");return yield d.promises.writeFile(this.nombreArchivo,JSON.stringify(e,null,2),"utf-8"),console.log(`Se eliminó el producto: ${t}`),"Se eliminó el producto"}catch(t){if(t instanceof l.default)throw t;throw new l.default(t,500,"Error")}}))}}},607:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(r(860)),n=r(824),s=o(r(505)),u=(0,i.default)();u.use(i.default.json()),u.use(i.default.urlencoded({extended:!0})),u.use("/api/productos",s.default),u.use("/api/carrito",n.routerCart),u.use(((t,e,r,o)=>{console.log(t),r.status(t.status).json({status:t.status,message:t.message})})),u.listen(8080,(()=>{console.log("conectado al puerto 8080")})).on("error",(t=>console.log(`error en el servidor ${t}`)))},844:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class r extends Error{constructor(t,e,r){super(t),this.status=e,this.name=r}}e.default=r},824:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.routerCart=void 0;const o=r(860),i=r(27),n=(0,o.Router)();e.routerCart=n;const s=new i.CartContainer("src/database/cartContainer.txt");n.post("/",((t,e)=>{let r=t.body;s.create(r).then((t=>t?e.status(200).json(t):e.status(500).json({error:"Ocurrió un error al crear el carrito"})))})),n.delete("/:id",((t,e)=>{let{id:r}=t.params;r&&s.deleteCartById(parseInt(r)).then((t=>t===parseInt(r)?e.status(200).json(t):e.status(500).json({error:`Ocurrió un error al eliminar el item ${r} `})))})),n.get("/:id/productos",((t,e)=>{let{id:r}=t.params;r&&s.getProductsInCart(parseInt(r)).then((t=>t?e.status(200).json(t):e.status(404).json({error:`Carrito #${r} no encontrado`})))})),n.post("/:id/productos",((t,e)=>{let{id:r}=t.params,o=t.body;s.addProductToCart(o,parseInt(r)).then((t=>t?e.status(200).json(t):e.status(500).json({error:`Ocurrió un error al agregar el producto ${o.id} al carrito ${r} `})))})),n.delete("/:id/productos/:id_prod",((t,e)=>{let{id:r,id_prod:o}=t.params;r&&s.deleteProductFromCart(parseInt(o),parseInt(r)).then((t=>t?e.status(200).json(t):e.status(500).json({error:`Ocurrió un error al eliminar el producto ${o} del carrito ${r} `})))}))},505:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(860),n=o(r(322)),s=(0,i.Router)();s.route("/").get(n.default.getProducts).post(n.default.createProduct),s.route("/:id").get(n.default.getProducts).put(n.default.updateProduct).delete(n.default.deleteProduct),e.default=s},860:t=>{t.exports=require("express")},147:t=>{t.exports=require("fs")}},e={};!function r(o){var i=e[o];if(void 0!==i)return i.exports;var n=e[o]={exports:{}};return t[o].call(n.exports,n,n.exports,r),n.exports}(607)})();